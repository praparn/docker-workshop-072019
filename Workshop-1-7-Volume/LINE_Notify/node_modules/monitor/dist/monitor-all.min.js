/* monitor - v0.6.10 - 2014-05-16 */
(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=O(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="0.9.9";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=/\s+/,f=function(e,t,n,r){if(!n)return!0;if(typeof n=="object")for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!a.test(n))return!0;var s=n.split(a);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r))}},l=function(e,t,n){var r,i=-1,s=t.length;switch(n.length){case 0:while(++i<s)(r=t[i]).callback.call(r.ctx);return;case 1:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0]);return;case 2:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0],n[1]);return;case 3:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0],n[1],n[2]);return;default:while(++i<s)(r=t[i]).callback.apply(r.ctx,n)}},c=o.Events={on:function(e,t,n){if(!f(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!f(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n),this},off:function(e,t,n){var r,i,s,o,a,l,c,h;if(!this._events||!f(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,l=o.length;a<l;a++){e=o[a];if(r=this._events[e]){s=[];if(t||n)for(c=0,h=r.length;c<h;c++)i=r[c],(t&&t!==(i.callback._callback||i.callback)||n&&n!==i.context)&&s.push(i);this._events[e]=s}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!f(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l(this,n,t),r&&l(this,r,arguments),this},listenTo:function(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=u.uniqueId("l"));return r[i]=e,e.on(t,n||this,this),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return;if(e)e.off(t,n,this),!t&&!n&&delete r[e._listenerId];else{for(var i in r)r[i].off(null,null,this);this._listeners={}}return this}};c.bind=c.on,c.unbind=c.off,u.extend(o,c);var h=o.Model=function(e,t){var n,r=e||{};this.cid=u.uniqueId("c"),this.changed={},this.attributes={},this._changes=[],t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r)),(n=u.result(this,"defaults"))&&u.defaults(r,n),this.set(r,{silent:!0}),this._currentAttributes=u.clone(this.attributes),this._previousAttributes=u.clone(this.attributes),this.initialize.apply(this,arguments)};u.extend(h.prototype,c,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i;if(e==null)return this;u.isObject(e)?(i=e,n=t):(i={})[e]=t;var s=n&&n.silent,o=n&&n.unset;if(!this._validate(i,n))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var a=this.attributes;for(r in i)t=i[r],o?delete a[r]:a[r]=t,this._changes.push(r,t);return this._hasComputed=!1,s||this.change(n),this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r),e))return!1;n&&n(t,r,e)},this.sync("read",this,e)},save:function(e,t,n){var r,i,s;e==null||u.isObject(e)?(r=e,n=t):e!=null&&((r={})[e]=t),n=n?u.clone(n):{};if(n.wait){if(r&&!this._validate(r,n))return!1;i=u.clone(this.attributes)}var o=u.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?o:n))return!1;if(!r&&!this._validate(null,n))return!1;var a=this,f=n.success;n.success=function(e,t,i){s=!0;var o=a.parse(e);n.wait&&(o=u.extend(r||{},o));if(!a.set(o,n))return!1;f&&f(a,e,n)};var l=this.isNew()?"create":n.patch?"patch":"update";l=="patch"&&(n.attrs=r);var c=this.sync(l,this,n);return!s&&n.wait&&(this.clear(o),this.set(i,o)),c},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e)};if(this.isNew())return e.success(),!1;var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||M();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){var t=this._changing;this._changing=!0;var n=this._computeChanges(!0);this._pending=!!n.length;for(var r=n.length-2;r>=0;r-=2)this.trigger("change:"+n[r],this,n[r+1],e);if(t)return this;while(this._pending)this._pending=!1,this.trigger("change",this,e),this._previousAttributes=u.clone(this.attributes);return this._changing=!1,this},hasChanged:function(e){return this._hasComputed||this._computeChanges(),e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},_computeChanges:function(e){this.changed={};var t={},n=[],r=this._currentAttributes,i=this._changes;for(var s=i.length-2;s>=0;s-=2){var o=i[s],u=i[s+1];if(t[o])continue;t[o]=!0;if(r[o]!==u){this.changed[o]=u;if(!e)continue;n.push(o,u),r[o]=u}}return e&&(this._changes=[]),this._hasComputed=!0,n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},_validate:function(e,t){if(!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validate(e,t);return n?(t&&t.error&&t.error(this,n,t),this.trigger("error",this,n,t),!1):!0}});var p=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))};u.extend(p.prototype,c,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){var n,i,o,a,f,l,c=t&&t.at,h=(t&&t.sort)==null?!0:t.sort;e=u.isArray(e)?e.slice():[e];for(n=e.length-1;n>=0;n--){if(!(a=this._prepareModel(e[n],t))){this.trigger("error",this,e[n],t),e.splice(n,1);continue}e[n]=a,f=a.id!=null&&this._byId[a.id];if(f||this._byCid[a.cid]){t&&t.merge&&f&&(f.set(a.attributes,t),l=h),e.splice(n,1);continue}a.on("all",this._onModelEvent,this),this._byCid[a.cid]=a,a.id!=null&&(this._byId[a.id]=a)}e.length&&(l=h),this.length+=e.length,i=[c!=null?c:this.models.length,0],r.apply(i,e),s.apply(this.models,i),l&&this.comparator&&c==null&&this.sort({silent:!0});if(t&&t.silent)return this;while(a=e.shift())a.trigger("add",a,this,t);return this},remove:function(e,t){var n,r,i,s;t||(t={}),e=u.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byCid[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]||this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return u.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),(!e||!e.silent)&&this.trigger("sort",this,e),this},pluck:function(e){return u.invoke(this.models,"get",e)},update:function(e,t){var n,r,i,s,o=[],a=[],f={},l=this.model.prototype.idAttribute;t=u.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e)),u.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);for(r=0,i=e.length;r<i;r++)n=e[r],s=this.get(n.id||n.cid||n[l]),t.remove&&s&&(f[s.cid]=!0),(t.add&&!s||t.merge&&s)&&o.push(n);if(t.remove)for(r=0,i=this.models.length;r<i;r++)n=this.models[r],f[n.cid]||a.push(n);return a.length&&this.remove(a,t),o.length&&this.add(o,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e));for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e&&this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){var o=e.update?"update":"reset";t[o](r,e),n&&n(t,r,e)},this.sync("read",this,e)},create:function(e,t){var n=this;t=t?u.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},chain:function(){return u(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){if(e instanceof h)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var d=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortedIndex","toArray","size","first","head","take","initial","rest","tail","last","without","indexOf","shuffle","lastIndexOf","isEmpty"];u.each(d,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var v=["groupBy","countBy","sortBy"];u.each(v,function(e){p.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var m=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},g=/\((.*?)\)/g,y=/:\w+/g,b=/\*\w+/g,w=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(m.prototype,c,{initialize:function(){},route:function(e,t,n){return u.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),o.history.route(e,u.bind(function(r){var i=this._extractParameters(e,r);n&&n.apply(this,i),this.trigger.apply(this,["route:"+t].concat(i)),o.history.trigger("route",this,t,i)},this)),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(w,"\\$&").replace(g,"(?:$1)?").replace(y,"([^/]+)").replace(b,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var E=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},S=/^[#\/]|\s+$/g,x=/^\/+|\/+$/g,T=/msie [\w.]+/,N=/\/$/;E.started=!1,u.extend(E.prototype,c,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(N,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(S,"")},start:function(e){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=T.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(x,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(S,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!E.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new E;var C=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},k=/^(\S+)\s*(.*)$/,L=["model","collection","el","id","attributes","className","tagName","events"];u.extend(C.prototype,c,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},make:function(e,t,n){var r=document.createElement(e);return t&&o.$(r).attr(t),n!=null&&o.$(r).html(n),r},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(k),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.bind(i,n):this.$el.delegate(s,i,n)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,L)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className")),this.setElement(this.make(u.result(this,"tagName"),e),!1)}else this.setElement(u.result(this,"el"),!1)}});var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.sync=function(e,t,n){var r=A[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||M()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1);var a=n.success;n.success=function(e,r,i){a&&a(e,r,i),t.trigger("sync",t,e,n)};var f=n.error;n.error=function(e,r,i){f&&f(t,e,n),t.trigger("error",t,e,n)};var l=o.ajax(u.extend(i,n));return t.trigger("request",t,l,n),l},o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var O=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};h.extend=p.extend=m.extend=C.extend=E.extend=O;var M=function(){throw new Error('A "url" property or function must be specified')}}.call(this),function(e){var t=e._||require("underscore")._,n=e.Backbone||require("backbone"),r=function(e,n){return function(){var r=t.toArray(arguments),i=r[r.length-1];if(typeof i=="function"){r.splice(-1,1),r.length===0&&r.push({}),r.length===1&&e==="save"&&r.push({});var s=r[r.length-1];s.success=function(e,t){i(null,t)},s.error=function(e,t){i(t,null)}}return n.apply(this,r)}};typeof module!="undefined"&&typeof module.exports!="undefined"?module.exports=r:e.BackboneCallbacks=r,r.attach=function(e){t.each(["save","destroy","fetch"],function(t){e.Model.prototype[t]=new r(t,e.Model.prototype[t])}),t.each(["fetch"],function(t){e.Collection.prototype[t]=new r(t,e.Collection.prototype[t])})},r.attach(n)}(this);var io="undefined"==typeof module?{}:module.exports;(function(){(function(e,t){var n=e;n.version="0.9.11",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var i=n.util.parseUri(e),s,o;t&&t.location&&(i.protocol=i.protocol||t.location.protocol.slice(0,-1),i.host=i.host||(t.document?t.document.domain:t.location.hostname),i.port=i.port||t.location.port),s=n.util.uniqueUri(i);var u={host:i.host,secure:"https"==i.protocol,port:i.port||("https"==i.protocol?443:80),query:i.query||""};n.util.merge(u,r);if(u["force new connection"]||!n.sockets[s])o=new n.Socket(u);return!u["force new connection"]&&o&&(n.sockets[s]=o),o=o||n.sockets[s],o.of(i.path.length>1?i.path:"")}})("object"==typeof module?module.exports:this.io={},this),function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){var t=r.exec(e||""),n={},s=14;while(s--)n[i[s]]=t[s]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||(n=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(r=r||"localhost",!i&&n=="https"&&(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];n.merge(r,n.chunkQuery(t||""));for(var s in r)r.hasOwnProperty(s)&&i.push(s+"="+r[s]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){var t={},n=e.split("&"),r=0,i=n.length,s;for(;r<i;++r)s=n[r].split("="),s[0]&&(t[s[0]]=s[1]);return t};var s=!1;n.load=function(e){if("document"in t&&document.readyState==="complete"||s)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&n.load(function(){s=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(t,r,i,s){var o=s||[],u=typeof i=="undefined"?2:i,a;for(a in r)r.hasOwnProperty(a)&&n.indexOf(o,a)<0&&(typeof t[a]!="object"||!u?(t[a]=r[a],o.push(r[a])):n.merge(t[a],r[a],u-1,o));return t},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},n.intersect=function(e,t){var r=[],i=e.length>t.length?e:t,s=e.length>t.length?t:e;for(var o=0,u=s.length;o<u;o++)~n.indexOf(i,s[o])&&r.push(s[o]);return r},n.indexOf=function(e,t,n){for(var r=e.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return e.withCredentials!=undefined}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function r(){n.removeListener(e,r),t.apply(this,arguments)}var n=this;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){var i=-1;for(var s=0,o=r.length;s<o;s++)if(r[s]===n||r[s].listener&&r[s].listener===n){i=s;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return e===undefined?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;var i=n.slice();for(var s=0,o=i.length;s<o;s++)i[s].apply(this,r)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a instanceof Date&&(a=date(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,typeof JSON!="undefined"?JSON:undefined),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],s=n.advice=["reconnect"],o=t.JSON,u=t.util.indexOf;n.encodePacket=function(e){var t=u(r,e.type),n=e.id||"",a=e.endpoint||"",f=e.ack,l=null;switch(e.type){case"error":var c=e.reason?u(i,e.reason):"",h=e.advice?u(s,e.advice):"";if(c!==""||h!=="")l=c+(h!==""?"+"+h:"");break;case"message":e.data!==""&&(l=e.data);break;case"event":var p={name:e.name};e.args&&e.args.length&&(p.args=e.args),l=o.stringify(p);break;case"json":l=o.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}var d=[t,n+(f=="data"?"+":""),a];return l!==null&&l!==undefined&&d.push(l),d.join(":")},n.encodePayload=function(e){var t="";if(e.length==1)return e[0];for(var n=0,r=e.length;n<r;n++){var i=e[n];t+="�"+i.length+"�"+e[n]}return t};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(a);if(!t)return{};var n=t[2]||"",e=t[5]||"",u={type:r[t[1]],endpoint:t[4]||""};n&&(u.id=n,t[3]?u.ack="data":u.ack=!0);switch(u.type){case"error":var t=e.split("+");u.reason=i[t[0]]||"",u.advice=s[t[1]]||"";break;case"message":u.data=e||"";break;case"event":try{var f=o.parse(e);u.name=f.name,u.args=f.args}catch(l){}u.args=u.args||[];break;case"json":try{u.data=o.parse(e)}catch(l){}break;case"connect":u.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t){u.ackId=t[1],u.args=[];if(t[3])try{u.args=t[3]?o.parse(t[3]):[]}catch(l){}}break;case"disconnect":case"heartbeat":}return u},n.decodePayload=function(e){if(e.charAt(0)=="�"){var t=[];for(var r=1,i="";r<e.length;r++)e.charAt(r)=="�"?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(e){this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(e!==""){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),e.type=="heartbeat"?this.onHeartbeat():(e.type=="connect"&&e.endpoint==""&&this.onConnect(),e.type=="error"&&e.advice=="reconnect"&&(this.isOpen=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){var e=this;this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"beforeunload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),e!==""&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},r.prototype.handshake=function(e){function s(t){t instanceof Error?(n.connecting=!1,n.onError(t.message)):e.apply(null,t.split(":"))}var n=this,r=this.options,o=["http"+(r.secure?"s":"")+":/",r.host+":"+r.port,r.resource,t.protocol,t.util.query(this.options.query,"t="+ +(new Date))].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var u=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=o+"&jsonp="+t.j.length,u.parentNode.insertBefore(a,u),t.j.push(function(e){s(e),a.parentNode.removeChild(a)})}else{var f=t.util.request();f.open("GET",o,!0),this.isXDomain()&&(f.withCredentials=!0),f.onreadystatechange=function(){f.readyState==4&&(f.onreadystatechange=i,f.status==200?s(f.responseText):f.status==403?n.onError(f.responseText):(n.connecting=!1,!n.reconnecting&&n.onError(f.responseText)))},f.send(null)}},r.prototype.getTransport=function(e){var n=e||this.transports,r;for(var i=0,s;s=n[i];i++)if(t.Transport[s]&&t.Transport[s].check(this)&&(!this.isXDomain()||t.Transport[s].xdomainCheck(this)))return new t.Transport[s](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(r,i,s,o){function u(e){n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(e);if(!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected){n.connecting=!1;if(n.options["try multiple transports"]){var e=n.transports;while(e.length>0&&e.splice(0,1)[0]!=n.transport.name);e.length?u(e):n.publish("connect_failed")}}},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=s*1e3,n.heartbeatTimeout=i*1e3,n.transports||(n.transports=n.origTransports=o?t.util.intersect(o.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),u(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&typeof e=="function"&&e()})}),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},r.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},r.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",n,!1),e.send(null),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&e.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1;if(t||n)this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect())},r.prototype.reconnect=function(){function i(){if(e.connected){for(var t in e.namespaces)e.namespaces.hasOwnProperty(t)&&""!==t&&e.namespaces[t].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer),e.removeListener("connect_failed",s),e.removeListener("connect",s),e.reconnecting=!1,delete e.reconnectionAttempts,delete e.reconnectionDelay,delete e.reconnectionTimer,delete e.redoTransports,e.options["try multiple transports"]=n}function s(){if(!e.reconnecting)return;if(e.connected)return i();if(e.connecting&&e.reconnecting)return e.reconnectionTimer=setTimeout(s,1e3);e.reconnectionAttempts++>=t?e.redoTransports?(e.publish("reconnect_failed"),i()):(e.on("connect_failed",s),e.options["try multiple transports"]=!0,e.transports=e.origTransports,e.transport=e.getTransport(),e.redoTransports=!0,e.connect()):(e.reconnectionDelay<r&&(e.reconnectionDelay*=2),e.connect(),e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts),e.reconnectionTimer=setTimeout(s,e.reconnectionDelay))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var e=this,t=this.options["max reconnection attempts"],n=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(s,this.reconnectionDelay),this.on("connect",s)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function r(){n.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var n=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];e.ack=="data"?i.push(r):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);e.ack=="data"&&i.push(r),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):e.reason=="unauthorized"?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(){var e=t.util.query(this.socket.options.query),r=this,i;return i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+e),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(e){r.onData(e.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(e){r.onError(e)},this},t.util.ua.iDevice?r.prototype.send=function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(){t.Transport.websocket.apply(this,arguments)}e.flashsocket=n,t.util.inherit(n,t.Transport.websocket),n.prototype.name="flashsocket",n.prototype.open=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.open.apply(e,n)}),this},n.prototype.send=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.send.apply(e,n)}),this},n.prototype.close=function(){return WebSocket.__tasks.length=0,t.Transport.websocket.prototype.close.call(this),this},n.prototype.ready=function(e,r){function i(){var t=e.options,i=t["flash policy port"],o=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,"static/flashsocket","WebSocketMain"+(e.isXDomain()?"Insecure":"")+".swf"];n.loaded||(typeof WEB_SOCKET_SWF_LOCATION=="undefined"&&(WEB_SOCKET_SWF_LOCATION=o.join("/")),i!==843&&WebSocket.loadFlashPolicyFile("xmlsocket://"+t.host+":"+i),WebSocket.__initialize(),n.loaded=!0),r.call(s)}var s=this;if(document.body)return i();t.util.load(i)},n.check=function(){return typeof WebSocket!="undefined"&&"__initialize"in WebSocket&&!!swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},n.xdomainCheck=function(){return!0},typeof window!="undefined"&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),t.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);if("undefined"!=typeof window)var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n(),t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");t&&(t=t.split(" ")[1].split(","),T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)])}else if(o<10){o++,setTimeout(arguments.callee,10);return}n.removeChild(r),s=null,M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312))V(r,!0),i&&(s.success=!0,s.ref=_(r),i(s));else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall,u.width=o.getAttribute("width")||"0",u.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(u.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else H(o),i&&i(s)}else{V(r,!0);if(i){var p=_(r);p&&typeof p.SetVariable!=e&&(s.success=!0,s.ref=p),i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0,g=i||null,y={success:!1,id:r};var o=R(r);if(o){o.nodeName=="OBJECT"?(v=B(o),m=null):(v=o,m=r),t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?["Active"].concat("").join("X"):"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew",c.setAttribute("id",r),o.parentNode.insertBefore(c,o),o.style.display="none",function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)}()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(B(e),t),e.style.display="none",function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>",p[p.length]=n.id,o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u),o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function I(e){var t=R(e);t&&t.nodeName=="OBJECT"&&(T.ie&&T.win?(t.style.display="none",function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n),d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";s&&(E=null,S=null);if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css"),f.setAttribute("media",u),E=o.appendChild(f),T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]),S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t)g=f.plugins[n].description,g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)&&(l=!0,v=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof u[["Active"].concat("Object").join("X")]!=e)try{var y=new(window[["Active"].concat("Object").join("X")])(r);y&&(g=y.GetVariable("$version"),g&&(v=!0,g=g.split(" ")[1].split(","),m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]))}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C(),b||(typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1),T.ie&&T.win&&(a.attachEvent(o,function(){a.readyState=="complete"&&(a.detachEvent(o,arguments.callee),C())}),u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()),T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}(),L(C))}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,h[h.length]=i,V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o?(V(r,!1),k(function(){i+="",s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n,p.width=i,p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0),h.success=!0,h.ref=y}else{if(u&&D()){p.data=u,P(p,v,r,c);return}V(r,!0)}c&&c(h)})):c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);e&&v&&(e.parentNode.replaceChild(v,e),m&&(V(m,!0),T.ie&&T.win&&(v.style.display="block")),g&&g(y)),w=!1}}}}();(function(){if("undefined"==typeof window||window.WebSocket)return;var e=window.console;if(!e||!e.log||!e.error)e={log:function(){},error:function(){}};if(!swfobject.hasFlashPlayerVersion("10.0.0")){e.error("Flash Player >= 10.0.0 is required.");return}location.protocol=="file:"&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(e,t,n,r,i){var s=this;s.__id=WebSocket.__nextId++,WebSocket.__instances[s.__id]=s,s.readyState=WebSocket.CONNECTING,s.bufferedAmount=0,s.__events={},t?typeof t=="string"&&(t=[t]):t=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(s.__id,e,t,n||null,r||0,i||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return t<0?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)return;this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)},WebSocket.prototype.addEventListener=function(e,t,n){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t,n){if(!(e in this.__events))return;var r=this.__events[e];for(var i=r.length-1;i>=0;--i)if(r[i]===t){r.splice(i,1);break}},WebSocket.prototype.dispatchEvent=function(e){var t=this.__events[e.type]||[];for(var n=0;n<t.length;++n)t[n](e);var r=this["on"+e.type];r&&r(e)},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if(e.type=="open"||e.type=="error")t=this.__createSimpleEvent(e.type);else if(e.type=="close")t=this.__createSimpleEvent("close");else{if(e.type!="message")throw"unknown event type: "+e.type;var n=decodeURIComponent(e.message);t=this.__createMessageEvent("message",n)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,t,null,null,window,null),n}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(WebSocket.__flash)return;WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation);if(!window.WEB_SOCKET_SWF_LOCATION){e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var n=document.createElement("div");n.id="webSocketFlash",t.appendChild(n),document.body.appendChild(t),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{var t=WebSocket.__flash.receiveEvents();for(var n=0;n<t.length;++n)WebSocket.__instances[t[n].webSocketId].__handleEvent(t[n])}catch(r){e.error(r)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return!e||!e.enabledPlugin||!e.enabledPlugin.filename?!1:e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))})(),function(e,t,n){function r(e){if(!e)return;t.Transport.apply(this,arguments),this.sendBuffer=[]}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){function r(){this.readyState==4&&(this.onreadystatechange=i,t.posting=!1,this.status==200?t.socket.setBuffer(!1):t.onClose())}function s(){this.onload=i,t.socket.setBuffer(!1)}var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=s:this.sendXHR.onreadystatechange=r,this.sendXHR.send(e)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +(new Date));n.open(e||"GET",this.prepareUrl()+r,!0);if(e=="POST")try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),s=n.XDomainRequest&&i instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",u=n.location&&o!=n.location.protocol;if(i&&(!s||!u))return!0}catch(a){}return!1},r.xdomainCheck=function(e){return r.check(e,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n,t.util.inherit(n,t.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date));this.iframe.src=this.prepareUrl()+r,t.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(e,t){this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(r){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},n.check=function(e){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&t.Transport.XHR.check(e)}catch(r){}return!1},n.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.heartbeats=function(){return!1},r.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},r.prototype.get=function(){function t(){this.readyState==4&&(this.onreadystatechange=i,this.status==200?(e.onData(this.responseText),e.get()):e.onClose())}function r(){this.onload=i,this.onerror=i,e.retryCounter=1,e.onData(this.responseText),e.get()}function s(){e.retryCounter++,!e.retryCounter||e.retryCounter>3?e.onClose():e.get()}if(!this.isOpen)return;var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=r,this.xhr.onerror=s):this.xhr.onreadystatechange=t,this.xhr.send(null)},r.prototype.onClose=function(){t.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function i(e){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var r=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=i,t.util.inherit(i,t.Transport["xhr-polling"]),i.prototype.name="jsonp-polling",i.prototype.post=function(e){function a(){f(),n.socket.setBuffer(!1)}function f(){n.iframe&&n.form.removeChild(n.iframe);try{u=document.createElement('<iframe name="'+n.iframeId+'">')}catch(e){u=document.createElement("iframe"),u.name=n.iframeId}u.id=n.iframeId,n.form.appendChild(u),n.iframe=u}var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(!this.form){var i=document.createElement("form"),s=document.createElement("textarea"),o=this.iframeId="socketio_iframe_"+this.index,u;i.className="socketio",i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.display="none",i.target=o,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}this.form.action=this.prepareUrl()+r,f(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(l){}this.iframe.attachEvent?u.onreadystatechange=function(){n.iframe.readyState=="complete"&&a()}:this.iframe.onload=a,this.socket.setBuffer(!0)},i.prototype.get=function(){var e=this,n=document.createElement("script"),i=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+i,n.onerror=function(){e.onClose()};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),this.script=n,r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype._=function(e){return this.onData(e),this.isOpen&&this.get(),this},i.prototype.ready=function(e,n){var i=this;if(!r)return n.call(this);t.util.load(function(){n.call(i)})},i.check=function(){return"document"in n},i.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),typeof define=="function"&&define.amd&&define([],function(){return io})})(),function(e){var t=typeof exports!="undefined",n=t?require("backbone"):e.Backbone,r=t?require("underscore")._:e._,i=null,s=null,o=[],u=t?require("cron"):null,a=4,f=n.Model.extend({defaults:{id:"",name:"",probeName:"",probeClass:"",initParams:{},hostName:"",appName:"",appInstance:"",probeId:"",writableAttributes:[]},initialize:function(e,t){i.info("init",e)},connect:function(e){var t=this,n=Date.now();f.getRouter().connectMonitor(t,function(r){!r&&t.get("writableAttributes").length>0&&t.on("change",t.onChange,t),e&&e(r),r||(t.trigger("connect",t),t.trigger("change",t),i.info("connected",{initParams:t.get("initParams"),probeId:t.get("probeId")}),s.time("connect",Date.now()-n))})},getConnection:function(){var e=this;return e.probe&&e.probe.connection?e.probe.connection:null},isConnected:function(){var e=this;return e.probe!=null},disconnect:function(e){var t=this,n="manual_disconnect",r=Date.now(),o=t.get("probeId");t.off("change",t.onChange,t),f.getRouter().disconnectMonitor(t,n,function(n,u){e&&e(n),n?i.error("disconnect",{error:n}):(t.trigger("disconnect",u),i.info("disconnected",{reason:u,probeId:o}),s.time("disconnect",Date.now()-r))})},onChange:function(){var e=this,t=e.get("writableAttributes"),n={},s=e.toProbeJSON();delete s.id;for(var o in s){var u=t==="*"||t.indexOf(o)>=0;u&&!r.isEqual(e.attributes[o],e._probeValues[o])&&(n[o]=e.attributes[o])}f._.size(n)&&e.control("set",n,function(t){t&&i.error("probeSet","Problem setting writable value",n,e.toMonitorJSON())})},control:function(e,t,n){var r=this,o=r.probe,u="control."+r.get("probeClass")+"."+e,a=Date.now();typeof t=="function"&&(n=t,t=null),i.info(u,t);var f=function(e,t){e?i.error(u,e):(i.info("return."+u,t),s.time(u,Date.now()-a)),n&&n.apply(r,arguments)};if(!o)return f("Probe not connected");o.connection?o.connection.emit("probe:control",{probeId:r.get("probeId"),name:e,params:t},f):o.onControl(e,t,f)},toProbeJSON:function(e){var t=this,n={id:t.get("probeId")};return r.each(t.toJSON(e),function(e,r){r in t.defaults||(n[r]=e)}),n},toMonitorJSON:function(e){var t=this,n={};return r.each(t.toJSON(e),function(e,r){r in t.defaults&&(n[r]=e)}),n},toServerString:function(){return f.toServerString(this.toMonitorJSON())}});f.generateUniqueId=function(){function e(){return((1+Math.random())*65536|0).toString(16).substring(1)}return s.increment("generateUniqueId"),e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},f.generateUniqueCollectionId=function(e,t){var n="";return t=t||"",e.idSequence||(e.idSequence=0,e.forEach(function(n){var r=n.get("id")||"",i=+r.substr(t.length);e.idSequence<=i&&(e.idSequence=i+1)})),t+e.idSequence++},f.getRouter=function(){return f.defaultRouter||(f.defaultRouter=new f.Router,e.io&&f.defaultRouter.setGateway({socket:e.io.connect()})),f.defaultRouter},f.start=function(e,t){return i.info("start",e),t=t||function(){},f.defaultServer?t():(f.defaultServer=new f.Server,f.defaultServer.start(e,t)),f},f.stop=function(e){i.info("stop"),e=e||function(){},f.defaultServer?(f.defaultServer.stop(e),delete f.defaultServer):e()},f.toServerString=function(e){var t=e.hostName;return e.appName&&(t+=":"+e.appName,e.appInstance&&(t+=":"+e.appInstance)),t},f.deepCopy=function(e,t){t=typeof t=="undefined"?a:t;if(typeof e!="object"&&typeof e!="function")return e;var n="[Object]";typeof e=="function"?n="[Function]":Array.isArray(e)&&(n="[Array]");if(t<=0)return n;var i=Array.isArray(e)?[]:{};for(var s in e)if(!e.hasOwnProperty||e.hasOwnProperty(s)){var o=e[s];typeof o=="object"||typeof o=="function"?i[s]=f.deepCopy(o,t-1):i[s]=o}return typeof e=="function"&&(r.isEmpty(i)?i=n:i=r.extend({constructor:n},i)),i},f.stringify=function(e,t,n){return n=typeof n=="undefined"?2:n,JSON.stringify(f.deepCopy(e,t),null,n)},f.setStatLoggerClass=function(e){f.getStatLogger=function(t){return new e(t)},s=f.getStatLogger("Monitor")},f.setLoggerClass=function(e){f.getLogger=function(t){return new e(t)},i=f.getLogger("Monitor")},f.List=n.Collection.extend({model:f});var l={appName:"unknown",serviceBasePort:42e3,portsToScan:20,allowExternalConnections:!1,consoleLogListener:{pattern:"{trace,warn,error,fatal}.*"},autoStart:[]};t?(f.Config=require("config"),f.Config.setModuleDefaults("Monitor",l)):f.Config={Monitor:l},f._=r,f.Backbone=n,f.Cron=u,f.commonJS=t,t?module.exports=f:e.Monitor=f;var c=f.Config.Monitor.autoStart;f._.size(c)&&setTimeout(function(){f._.each(c,function(e){var t=new f(e);t.connect(function(n){n&&i.error("autoStart","Error auto-starting monitor",e,n),o.push(t)})})},0)}(this),function(e){var t=e.Monitor||require("./Monitor"),n=t.commonJS?require("events").EventEmitter.prototype:t.Backbone.Events,r=t._,i=!1,s=t.Stat=function(e){var t=this;t.module=e},o=s.prototype;s.eventRegex={},o.increment=function(e,t){t=r.isNumber(t)?t:1,s._emit(this.module,e,t,"c")},o.decrement=function(e,t){t=r.isNumber(t)?t:1,s._emit(this.module,e,t*-1,"c")},o.gauge=function(e,t){s._emit(this.module,e,t,"g")},o.time=function(e,t){s._emit(this.module,e,t,"ms")},s._emit=function(e,t,n,r){var o,u;if(i)return;i=!0;for(o in s._events){u||(u=e+"."+t);var a=s.eventRegex[o];a||(a=s.eventRegex[o]=s._buildRegex(o)),a.test(u)&&s.emit(o,e,t,n,r)}i=!1},s._buildRegex=function(e){var t="",n="",r=e.length-1,i=!1;if(/^\/[^\/]*\/i*$/.test(e))/i$/.test(e)&&(n="i",e=e.replace(/i$/,"")),t="^"+e.replace(/^\//,"").replace(/\/$/,"")+"$";else{for(var s=0,o=e.length;s<o;s++){var u=e.substr(s,1);switch(u){case".":u="\\.";break;case"*":u=s===r?".*":"[^\\.]*";break;case"{":u="(",i=!0;break;case"}":u=")",i=!1;break;case",":i&&(u="|")}t+=u}t="^"+t+"$"}return new RegExp(t,n)},r.extend(s,n),t.setStatLoggerClass(s)}(this),function(e){var t=e.Monitor||require("./Monitor"),n=t.commonJS?require("events").EventEmitter.prototype:t.Backbone.Events,r=t.Stat,i=new r("Log"),s=t._,o=!1,u=t.Log=function(e){var t=this;t.module=e},a=u.prototype;u.eventRegex={},["trace","debug","info","warn","error","fatal"].forEach(function(e){a[e]=function(t){u._emit(e,this.module,t,arguments)}}),u._emit=function(e,t,n,a){var f,l=e+"."+t+"."+n;if(o)return;o=!0,i.increment(l);for(f in u._events){var c=u.eventRegex[f];c||(c=u.eventRegex[f]=r._buildRegex(f));if(c.test(l)){var h=s.toArray(a),p=u.emit||u.trigger;h.splice(0,1,f,e,t,n),p.apply(u,h)}}o=!1},s.extend(u,n),t.setLoggerClass(u),u.console=function(e,n,r){var i=(new Date).toJSON(),o=s.toArray(arguments),u="["+i+"] ["+e.toUpperCase()+"] "+n;o.splice(0,3),o.length===0?o=[r]:u+="."+r,u+=" - ";if(o.length===1&&typeof o[0]=="string")u+=o[0];else try{u+=JSON.stringify(o)}catch(a){u+=t.stringify(o)}e==="error"||e==="fatal"?console.error(u):console.log(u)};var f=t.Config.Monitor.consoleLogListener.pattern;f&&u.on(f,u.console)}(this),function(e){var t=e.Monitor||require("./Monitor"),n=t.getLogger("Probe"),r=t.getStatLogger("Probe"),i=t.Cron,s=t._,o=t.Backbone,u=t.Probe=o.Model.extend({defaults:{id:null},initialize:function(e,t){var r=this;n.info("init",r.toJSON(),t)},release:function(){var e=this;n.info("release",e.toJSON())},onControl:function(e,t,i){var s=this,o=s[e+"_control"],u=Date.now(),a,f="onControl."+s.probeClass+"."+e;t=t||{},i=i||function(){},n.info(f,s.get("id"),t);if(!o)return a="No control function: "+e,n.error(f,a),i({msg:a});var l=function(e){if(e)return n.error(f+".whenDone",e),i(e);var o=Date.now()-u;n.info(f,t),r.time(s.logId,o),i.apply(null,arguments)};setTimeout(function(){try{o.call(s,t,l)}catch(n){a="Error calling control: "+s.probeClass+":"+e,l({msg:a,err:n.toString()})}},0)},set_control:function(e,t){var r=this,i=r.get("writableAttributes")||[];if(i!=="*")for(var s in e)if(i.indexOf(s)<0)return t({code:"NOT_WRITABLE",msg:"Attribute not writable: "+s});var o=null;return r.set(e)||(o={code:"VALIDATION_ERROR",msg:"Data set failed validation"},n.warn("set_control",o)),t(o)},ping_control:function(e,t){return t(null,"pong")}});u.classes={},u.extend=function(e){var t=this,n=o.Model.extend.apply(t,arguments);return e.probeClass&&(u.classes[e.probeClass]=n),n},u.List=o.Collection.extend({model:u})}(this),function(e){var t=e.Monitor||require("./Monitor"),n=t.Cron,r=t._,i=t.Backbone,s=t.getLogger("Connection"),o=t.getStatLogger("Connection"),u=t.Config,a=e.io||require("socket.io-client"),f=t.Probe,l=1,c=t.Connection=i.Model.extend({defaults:{hostName:"",hostPort:null,url:null,socket:null,gateway:!1,firewall:!1,remoteHostName:null,remoteAppName:null,remoteAppInstance:0,remotePID:0,remoteProbeClasses:[],remoteGateway:!1,remoteFirewall:!1},initialize:function(e){var t=this;t.connecting=!0,t.connected=!1,t.socketEvents=null,t.remoteProbeIdsByKey={},t.remoteProbesById={},t.incomingMonitorsById={},t.logId=l++ +".",e.socket?(t.bindConnectionEvents(),s.info(t.logId+"connect",{socketId:e.socket.id})):e.url||e.hostName&&e.hostPort?(t.connect(),s.info(t.logId+"connect",{url:t.get("url")})):s.error("init","Connection must supply a socket, url, or host name/port")},connect:function(){var e=this,t=e.get("hostName"),n=e.get("hostPort"),r=e.get("url");r||(r=e.attributes.url="http://"+t+":"+n,e.set("url",r));var i={"force new connection":!0,reconnect:!1},s=a.connect(r,i);e.set({socket:s}).bindConnectionEvents()},ping:function(e){var t=this;e=e||function(){};var n=function(){t.off("pong",n),e()};t.on("pong",n),t.emit("connection:ping")},disconnect:function(e){var t=this,n=t.get("socket");t.connecting=!1,t.connected=!1,t.socketEvents&&(t.removeAllEvents(),n.disconnect(),t.trigger("disconnect",e),s.info(t.logId+"disconnect",e))},isThisHost:function(e){var t=this,n=e.toLowerCase(),r=t.get("hostName"),i=t.get("remoteHostName");return r=r&&r.toLowerCase(),i=i&&i.toLowerCase(),n===r||n===i},emit:function(){var e=this,n=e.get("socket");s.info(e.logId+"emit",t.deepCopy(arguments,5)),n.emit.apply(n,arguments)},addEvent:function(e,t){var n=this,r=n.get("socket");n.socketEvents=n.socketEvents||{};if(n.socketEvents[e])throw new Error("Event already connected: "+e);return r.on(e,t),n.socketEvents[e]=t,n},removeEvent:function(e){var t=this,n=t.get("socket");return t.socketEvents&&t.socketEvents[e]&&(n.removeListener(e,t.socketEvents[e]),delete t.socketEvents[e]),t},removeAllEvents:function(){var e=this,t=e.get("socket");for(var n in e.socketEvents)t.removeListener(n,e.socketEvents[n]);return e.socketEvents=null,e},bindConnectionEvents:function(){var e=this,n=e.get("socket");if(e.socketEvents)throw new Error("Already connected");e.socketEvents={},e.addEvent("connect_failed",function(){e.trigger("error","connect failed"),e.disconnect("connect failed")}),e.addEvent("disconnect",function(){e.disconnect("remote_disconnect")}),e.addEvent("error",function(t){e.trigger("error",t),e.disconnect("connect error")}),e.addEvent("probe:connect",e.probeConnect.bind(e)),e.addEvent("probe:disconnect",e.probeDisconnect.bind(e)),e.addEvent("probe:control",e.probeControl.bind(e)),e.addEvent("connection:ping",function(){n.emit("connection:pong")}),e.addEvent("connection:pong",function(){e.trigger("pong")}),e.addEvent("connection:info",function(t){e.set({remoteHostName:t.hostName,remoteAppName:t.appName,remoteAppInstance:t.appInstance,remotePID:t.pid,remoteProbeClasses:t.probeClasses,remoteGateway:t.gateway,remoteFirewall:t.firewall}),e.connecting=!1,e.connected=!0,e.trigger("connect")});var i=typeof process=="undefined"?1:process.pid,s=""+(typeof process=="undefined"?i:process.env.NODE_APP_INSTANCE||i);n.emit("connection:info",{hostName:t.getRouter().getHostName(),appName:u.Monitor.appName,appInstance:s,pid:i,probeClasses:r.keys(f.classes),gateway:e.get("gateway"),firewall:e.get("firewall")})},probeConnect:function(e,n){n=n||function(){};var i=this,u="",a=t.getRouter(),f=i.get("gateway"),l=Date.now(),c=i.get("firewall"),h=r.extend({},e);if(c)return u="firewalled",s.error("probeConnect",u,h),n(u);a.determineConnection(e,f,function(r,u){if(r)return n(r);if(u&&!f)return n("Not a gateway");var c=function(r,u){if(r)return s.error(i.logId+"probeConnect",r,h),n(r);var a=u.get("id");h.id=a;var f=i.incomingMonitorsById[a];if(f!=null)return u.refCount--,h.dupDetected=!0,h.refCount=u.refCount,s.info(i.logId+"probeConnected",h),n(null,f.probe.toJSON());f=new t(e),f.set("probeId",a),i.incomingMonitorsById[a]=f,f.probe=u,f.probeChange=function(){try{i.emit("probe:change:"+a,u.changedAttributes())}catch(e){s.error("probeChange",e,u,h)}},u.connectTime=Date.now();var c=u.connectTime-l;h.duration=c,h.refCount=u.refCount,s.info(i.logId+"probeConnected",h),o.time(i.logId+"probeConnected",c),n(null,u.toJSON()),u.on("change",f.probeChange),i.on("disconnect",function(){i.probeDisconnect({probeId:a})})};u?a.connectExternal(e,u,c):a.connectInternal(e,c)})},probeDisconnect:function(e,n){n=n||function(){};var r=this,i="",u=t.getRouter(),a=e.probeId,f=r.incomingMonitorsById[a],l=r.get("firewall"),c=null,h=null;if(!f||!f.probe)return n(null);h=f.probe,c={probeClass:f.get("probeClass"),initParams:f.get("initParams"),probeId:a};var p=function(e){if(e)return s.error(r.logId+"probeDisconnect",e),n(e);var t=c.duration=Date.now()-h.connectTime;return h.off("change",f.probeChange),f.probe=f.probeChange=null,delete r.incomingMonitorsById[a],s.info(r.logId+"probeDisconnected",c),o.time(r.logId+"probeDisconnected",t),n(null)};h&&h.connection?u.disconnectExternal(h.connection,a,p):u.disconnectInternal(a,p)},probeControl:function(e,n){n=n||function(){};var r=this,i="",u=r.logId+"probeControl",a=Date.now(),f=t.getRouter(),l=r.get("firewall");if(l)return i="firewalled",s.error(u,i),n(i);var c=function(e){if(e)return s.error(u,e),n(e);var t=Date.now()-a;return s.info(u+".return",{duration:t,returnArgs:arguments}),o.time(u,t),n.apply(null,arguments)},h=f.runningProbesById[e.probeId];if(!h){var p=r.incomingMonitorsById[e.probeId];return p?p.control(e.name,e.params,function(e,t){c(e,t)}):(i="Probe id not found: "+e.probeId,s.error(i),n(i))}return u=u+"."+h.probeClass+"."+e.name,s.info(u+".request",{params:e.params,probeId:e.probeId}),h.onControl(e.name,e.params,c)}});c.List=i.Collection.extend({model:c})}(this),function(e){var t=e.Monitor||require("./Monitor"),n=t.Config,r=t._,i=t.Backbone,s=t.getLogger("Server"),o=t.getStatLogger("Server"),u=t.Connection,a=t.commonJS?require("http"):null,f=e.io||require("socket.io"),l=t.Server=i.Model.extend({initialize:function(e){var t=this;t.isListening=!1,t.connections=new u.List},start:function(e,t){typeof e=="function"&&(t=e,e=null),e=e||{},t=t||function(){};var r=this,i=r.get("server"),o,u=Date.now(),f=e.port||n.Monitor.serviceBasePort,l=e.attempt||1,c=n.Monitor.allowExternalConnections;if(l>n.Monitor.portsToScan)return o={err:"connect:failure",msg:"no ports available"},s.error("start",o),t(o);if(i)r.bindEvents(t);else{i=a.createServer(),i.on("error",function(e){if(e.code==="EADDRINUSE")return r.get("port")?(s.error("portInUse",{host:h,port:f}),t({err:"portInUse"})):(s.info("portInUse",{host:h,port:f}),r.start({port:f+1,attempt:l+1},t));t(e)});var h=c?"0.0.0.0":"127.0.0.1";i.listen(f,h,function(){process.env.NODE_APP_INSTANCE||(process.env.NODE_APP_INSTANCE=""+(f-n.Monitor.serviceBasePort+1)),r.set({server:i,port:f}),r.bindEvents(t),s.info("listening",{appName:n.Monitor.appName,NODE_APP_INSTANCE:process.env.NODE_APP_INSTANCE,listeningOn:h,port:f})})}},bindEvents:function(e){var n=this,r=n.get("server");r.on("clientError",function(e){s.error("bindEvents","clientError detected on server",e),n.trigger("error",e)}),r.on("close",function(e){r.hasEmittedClose=!0,s.info("bindEvents.serverClose","Server has closed",e),n.stop()});var i={log:!1};n.socketServer=f.listen(r,i),n.socketServer.sockets.on("connection",function(e){var r=t.getRouter().addConnection({socket:e,gateway:n.get("gateway")});n.connections.add(r);var i=function(e){n.connections.remove(r),t.getRouter().removeConnection(r),r.off("disconnect",i),s.info("client.disconnect","Disconnected client socket")};r.on("disconnect",i),s.info("client.connect","Connected client socket")}),n.isListening=!0,e&&e(null),n.trigger("start")},stop:function(e){var n=this,r=n.get("server"),i=t.getRouter();return e=e||function(){},n.isListening?(n.connections.each(i.removeConnection,i),n.connections.reset(),n.isListening=!1,r.close(),n.trigger("stop"),e()):e()}});l.List=i.Collection.extend({model:l})}(this),function(e){var t=e.Monitor||require("./Monitor"),n=t.getLogger("Router"),r=t.getStatLogger("Router"),i=t.Cron,s=t._,o=t.Backbone,u=t.Config,a=t.Probe,f=t.Connection,l=t.Server,c=e.io||require("socket.io"),h=t.commonJS?require("os").hostname():null,p=1e4,d=t.Router=o.Model.extend({initialize:function(){var e=this;e.defaultGateway=null,e.firewall=!1,e.connections=new f.List,e.runningProbesByKey={},e.runningProbesById={},e.addHostCallbacks={},n.info("init","Router initialized")},setFirewall:function(e){var r=t.getRouter();r.firewall=e,n.info("setFirewall",e)},setGateway:function(e){var t=this;return e.gateway=!1,e.firewall=!0,t.defaultGateway=t.addConnection(e)},getHostName:function(){var n=e.localStorage;return h||(n&&(h=n.hostName),h=h||t.generateUniqueId(),n&&(n.hostName=h)),h},setHostName:function(e){h=e,n.info("setHostName",e)},addConnection:function(e){var r=this,i=Date.now();s.isUndefined(e.firewall)&&(e=s.extend({},e,{firewall:r.firewall})),e.id=t.generateUniqueCollectionId(r.connections);var o="Conn_"+e.id;e.hostName&&(o+=" - "+e.hostName+":"+e.hostPort),n.info("addConnection",o);var u=new f(e),a=function(){r.trigger("connection:add",u),n.info("connected",o,Date.now()-i+"ms")},l=function(){r.removeConnection(u),u.off("connect",a),u.off("disconnect",a),n.info("disconnected",o,Date.now()-i+"ms")};return u.on("connect",a),u.on("disconnect",l),r.connections.add(u),u},removeConnection:function(e){var t=this;n.info("removeConnection","Conn_"+e.id),e.disconnect("connection_removed"),t.connections.remove(e),t.trigger("connection:remove",e)},connectMonitor:function(e,t){t=t||function(){};var r=this,i=e.toMonitorJSON(),o=null,u=i.probeName,a=i.probeClass,f=Date.now(),l=a+"."+e.toServerString().replace(/:/g,".");if(!a&&!u){var c="probeName or probeClass must be set";return n.error("connectMonitor",c),t(c)}r.determineConnection(i,!0,function(u,a){if(u)return t(u);var f=function(r,i){if(r)return t(r);o=i.toJSON(),o.probeId=o.id,delete o.id,e.probe=i,e._probeValues=s.clone(o),e.set(o,{silent:!0}),e.probeChange=function(){var t=i.changedAttributes();t&&(e._probeValues=s.clone(i.toJSON()),e.set(i.changedAttributes()),n.info("probeChange",{probeId:o.probeId,changed:i.changedAttributes()}))},i.on("change",e.probeChange),t(null)};a?r.connectExternal(i,a,f):r.connectInternal(i,f)})},disconnectMonitor:function(e,t,n){n=n||function(){};var r=this,i=e.probe,s=e.get("probeId");if(!i)return n("Monitor must be connected");var o=function(r){return r?n(r):(i.off("change",e.probeChange),e.set({probeId:null}),e.probe=e.probeChange=null,n(null,t))};i.connection?r.disconnectExternal(i.connection,s,o):r.disconnectInternal(s,o)},buildProbeKey:function(e){var t=e.probeClass,n=e.initParams;return e.probeName?e.probeName:(n&&s.keys(n).sort().forEach(function(e){t+=":"+e+"="+n[e]}),t)},determineConnection:function(e,r,i){var s=this,o=null,f=e.probeName,l=e.probeClass,c="",h=e.hostName,p=e.appName,d=e.appInstance,v=s.getHostName().toLowerCase(),m=u.Monitor.appName||"unknown",g=typeof process!="undefined"?process.env.NODE_APP_INSTANCE:"1",y=function(t){t||(delete e.hostName,delete e.appName,delete e.appInstance);var r=function(){u(),i(null,o)},s=function(e){u(),n.error("connect.error",e),i({msg:"connection error",err:e})},u=function(){o.off("connect",r),o.off("error",s)};if(o&&o.connecting){o.on("connect",r),o.on("error",s);return}return o&&!o.connected?(o.on("connect",r),o.on("error",s),o.connect()):i(null,o)};h=h?h.toLowerCase():null;var b=!h||h===v,w=!p||p===m,E=!d||d===g;if(b&&w&&E){if(s.runningProbesByKey[f]||a.classes[l]!=null)return i(null,null);var S=t.Config.Monitor.autoStart;if(f&&!l&&S.length){var x=t._.find(S,function(e){return e.probeName===f});if(x){setTimeout(function(){s.determineConnection(e,r,i)},10);return}}return s.defaultGateway?(o=s.defaultGateway,y(!0)):(c='Probe class "'+l+'" not available in this process',n.error("connect.internal",c),i({err:c}))}o=s.findConnection(h,p,d);if(o)return y();if(s.defaultGateway)return o=s.defaultGateway,y(!0);if(h&&r){s.addHostConnections(h,function(r){return r?(n.error("connect.toHost",r),i(r)):(o=s.findConnection(h,p,d),o?y():(c="No route to host: "+t.toServerString(e),n.error("connect.toHost",c),i({err:c})))});return}return h?(c="Not a gateway to remote monitors",n.error("connect",c),i({msg:c})):(c="No host specified for app: "+p,n.error("connect",c),i({msg:c},null))},findConnection:function(e,t,n){var r=this,i=0;return r.connections.find(function(r){var i=!e||r.isThisHost(e),s=!t||t===r.get("remoteAppName"),o=!n||n===r.get("remoteAppInstance"),u=r.get("remoteFirewall");return!u&&i&&s&&o})},findConnections:function(e,t){var n=this;return n.connections.filter(function(n){var r=!e||n.isThisHost(e),i=!t||t===n.get("remoteAppName"),s=n.get("remoteFirewall");return!s&&r&&i})},addHostConnections:function(e,t){var r=this,i="",s=[],o=u.Monitor.serviceBasePort,a=u.Monitor.serviceBasePort+u.Monitor.portsToScan-1;r.addHostCallbacks[e]||(r.addHostCallbacks[e]=[]);if(r.addHostCallbacks[e].push(t)>1)return;var f=function(t){r.addHostCallbacks[e].forEach(function(e){e(t)}),delete r.addHostCallbacks[e]};r.connections.each(function(t){var n=t.get("hostName").toLowerCase(),r=t.get("hostPort");n===e&&r>=o&&r<=a&&s.push(r)});var l=u.Monitor.portsToScan-s.length;if(l===0)return i="All monitor ports in use.  Increase the Config.Monitor.portsToScan configuration",n.error("addHostConnections",i),f(i);var c=function(){var e=this;e.off("connect disconnect error",c);if(--l===0)return f()};for(var h=o;h<=a;h++)if(s.indexOf(h)<0){var p=r.addConnection({hostName:e,hostPort:h});p.on("connect disconnect error",c,p)}},connectInternal:function(e,r){var i=this,s=i.buildProbeKey(e),o=e.probeName,u=e.probeClass,f=e.initParams,l=null,c=function(e){setTimeout(function(){if(e){if(l){delete i.runningProbesByKey[s],delete i.runningProbesById[l.id];try{l.release()}catch(t){}}return r(e)}l.refCount++,n.info("connectInternal",{probeKey:s,probeId:l.id}),r(null,l)},0)};l=i.runningProbesByKey[s];if(!l){var h=a.classes[u];if(!h)return c({msg:"Probe not available: "+u});var p={asyncInit:!1,callback:c};try{var d=t.deepCopy(f);o&&(d.probeName=o),l=new h(d,p),l.set({id:t.generateUniqueId(),writableAttributes:h.prototype.writableAttributes||[]}),l.refCount=0,l.probeKey=s,i.runningProbesByKey[s]=l,i.runningProbesById[l.id]=l}catch(v){var m={msg:"Error instantiating probe "+u,error:v.message};return c(m)}if(p.asyncInit)return}c()},disconnectInternal:function(e,t){var n=this,r=n.runningProbesById[e];if(!r)return t("Probe not running");--r.refCount===0&&setTimeout(function(){if(r.refCount===0){try{r.release()}catch(t){}delete n.runningProbesByKey[r.probeKey],delete n.runningProbesById[e]}},p),t(null,r)},connectExternal:function(e,r,i){var s=this,o="",u=s.buildProbeKey(e),f=r.remoteProbeIdsByKey[u],l=r.remoteProbesById[f];if(!l){r.emit("probe:connect",e,function(s,c){return s?(o="probe:connect returned an error for probeClass '"+e.probeClass+"' on "+t.toServerString(e),i({err:s,msg:o})):(f=c.id,l=r.remoteProbesById[f],l?(l.refCount++,n.info("connectExternal.connected.existingProxy",{probeId:f,refCount:l.refCount,whileWaiting:!0}),i(null,l)):(l=new a(c),l.refCount=1,l.connection=r,r.remoteProbeIdsByKey[u]=f,r.remoteProbesById[f]=l,r.addEvent("probe:change:"+f,function(e){l.set(e)}),n.info("connectExternal.connected.newProxy",{probeId:f}),i(null,l)))});return}return l.refCount++,n.info("connectExternal.connected.existingProxy",{probeId:f,refCount:l.refCount}),i(null,l)},disconnectExternal:function(e,t,n){var r=this,i=e.remoteProbesById[t];if(!i)return n("Probe not running");if(--i.refCount===0)return i.release(),i.connection=null,delete e.remoteProbesById[t],delete e.remoteProbeIdsByKey[i.probeKey],e.removeEvent("probe:change:"+t),e.emit("probe:disconnect",{probeId:t},function(e){return n(e)});n(null)}})}(this),function(e){var t=e.Monitor||require("./Monitor"),n=t.getLogger("Sync"),r=t.Backbone,i=t._,s="create",o="read",u="update",a="delete";t.Sync=function(e,t){if(!e)throw new Error("Sync class name must be provided");var r=new f(e,t);return function(t,i,s){return n.info("sync",{className:e,method:t,model:i.toJSON(),options:s}),r._sync(t,i,s)}};var f=function(e,t){var r=this;n.info("syncInit",e,t),r.className=e,r.options=t||{}};f.prototype._sync=function(e,i,u){var a=this;u=u||{};if(u.liveSync&&i instanceof r.Collection)return u.error(null,"Cannot liveSync with a collection");if(!i.has("id")){if(e!==s)return u.error(null,"ID element must be set.");i.set({id:t.generateUniqueId()},{silent:!0}),n.info("_sync.generateUniqueId",a.className,i.toJSON(),u)}if(e===s&&u.liveSync){a._sync(e,i,{error:u.error,success:function(e){a._sync(o,i,u)}});return}var f=function(e,t){e?(u.silenceErrors||n.error("_sync.onComplete",a.className,e),u.error(null,e)):(n.info("_sync.onComplete",a.className,i.get("id")),u.success(t))};if(i.syncMonitor||a.syncMonitor&&!u.liveSync){var l=i.syncMonitor||a.syncMonitor,c=a._getOpts(e,i);l.control(e,c,f)}else u.liveSync?a._connectInstanceMonitor(e,i,u,f):a._connectClassMonitor(e,i,u,f)},f.prototype._connectClassMonitor=function(e,r,i,s){var o=this;n.info("connectClassMonitor",o.className,e,r.toJSON());var u=o._getMonitorParams(null),a=new t(u);a.connect(function(t){if(t)return i.silenceErrors||n.error("connectClassMonitor",t),s(t);o.syncMonitor=a;var u=o._getOpts(e,r);a.control(e,u,s)})},f.prototype._connectInstanceMonitor=function(e,r,s,u){var a=this,f,l=r.get("id"),c=function(e){if(e)return u(e);var t=function(){n.info("disconnectLiveSync",a.className,r.toJSON()),r.off("change",s),r.syncMonitor.off("change",o),r.syncMonitor.disconnect(),r.syncMonitor=null},s=function(e,s){s=s||{};if(i.isEqual(JSON.parse(JSON.stringify(r)),JSON.parse(JSON.stringify(r.syncMonitor.get("model"))))){n.info("modelListener.noChanges",a.className,r.toJSON());return}if(r.get("id")!==l)return n.info("modelListener.alteredId",a.className,r.toJSON()),t();s.isSyncChanging||(n.info("modelListener.saving",a.className,r.toJSON()),r.save())},o=function(e,s){var o=r.syncMonitor.get("model");if(i.isEqual(JSON.parse(JSON.stringify(r)),JSON.parse(JSON.stringify(o)))){n.info("monitorListener.noChanges",a.className,o);return}var u=i.size(o)===0;if(u||o.id!==l)n.info("modelListener.deleted",a.className,o),t();var f={isSyncChanging:!0};u?(n.info("modelListener.deleting",a.className,o),r.clear(f)):(n.info("modelListener.setting",a.className,o),r.clear({silent:!0}),r.set(o,f))};r.on("change",s),r.syncMonitor.on("change",o),n.info("connectInstanceMonitor.done",a.className,r.toJSON()),u(null,r.syncMonitor.get("model"))},h=a._getMonitorParams(l);f=new t(h),f.connect(function(t){if(t)return s.silenceErrors||n.error("connectInstanceMonitor.monitorConnect",t),c(t);r.syncMonitor=f;if(e===o)return c();var i=a._getOpts(e,r);n.info("connectInstanceMonitor.forwarding",e,a.className,r.toJSON()),f.control(e,i,c)})},f.prototype._getOpts=function(e,t){var n={};switch(e){case o:case a:n.id=t.get("id");break;case s:case u:n.model=t.toJSON()}return n},f.prototype._getMonitorParams=function(e){var t=this,n=i.pick(t.options,"hostName","appName","appInstance");return n.probeClass="Sync",n.initParams={className:t.className},e&&(n.initParams.modelId=e),n}}(this),function(e){var t=e.Monitor||require("../Monitor"),n=t.DataModelProbe=t.Probe.extend({probeClass:"DataModel",writableAttributes:"*"})}(this),function(root){var Monitor=root.Monitor||require("../Monitor"),_=Monitor._,Cron=Monitor.Cron,logger=Monitor.getLogger("RecipeProbe"),vm=Monitor.commonJS?require("vm"):null,Probe=Monitor.Probe,RecipeProbe=Monitor.RecipeProbe=Probe.extend({probeClass:"Recipe",writableAttributes:[],defaults:{recipeName:"",monitors:{},script:"",autoStart:!1,started:!1,triggeredBy:null},initialize:function(e,t){var n=this;n.interval=null,n.cronJob=null;if(_.size(n.get("monitors"))===0){logger.error("initialize","No monitors defined in the recipe");return}n.monitors={},n.get("autoStart")&&(t.asyncInit=!0,n.start_control({},t.callback))},release:function(){var e=this,t=arguments;e.stop_control({},function(){Probe.prototype.release.apply(e,t)})},start_control:function(e,t){var n=this,r=!1,i=n.get("monitors");if(n.get("started")){var s={code:"RUNNING",msg:"Cannot start - the recipe is already running."};return logger.warn(s),t(s)}var o=function(e){if(r)return;if(e){var i={code:"CONNECT_ERROR",err:e};return r=!0,logger.error("start",i),t(i)}for(var s in n.monitors)if(!n.monitors[s].isConnected())return;n.set({started:!0}),n.connectListeners(!0),t()};for(var u in i)n.monitors[u]=new Monitor(i[u]),n.monitors[u].connect(o)},stop_control:function(e,t){var n=this,r=!1;if(!n.get("started")){var i={code:"NOT_RUNNING",msg:"The recipe is already stopped."};return logger.warn("precondition",i),t(i)}var s=function(e){if(r)return;if(e){var i={code:"DISONNECT_ERROR",err:e};return r=!0,logger.error("onDisconnect",i),t(i)}for(var s in n.monitors)if(n.monitors[s].isConnected())return;n.set({started:!1}),n.compiledScript=null,t()};n.connectListeners(!1),n.context=null;for(var o in n.monitors)n.monitors[o].disconnect(s)},connectListeners:function(e){var t=this,n=t.get("triggeredBy"),r=t.onTrigger.bind(t);if(!n){for(var i in t.monitors)t.monitors[i][e?"on":"off"]("change",t.onTrigger,t);return}for(var s in n){var o=n[s];s==="cron"?e?t.cronJob=new Cron.CronJob(o,r):t.cronJob.initiated?clearInterval(t.CronJob.timer):setTimeout(function(){clearInterval(t.cronJob.timer)},1e3):s==="interval"?e?t.interval=setInterval(r,o):(clearInterval(t.interval),t.interval=null):t.monitors[s][e?"on":"off"](o,r)}},onTrigger:function(){var e=this;e.run_control({},function(e){e&&logger.error("onTrigger",e)})},run_control:function(e,t){var n=this,r=null;if(!n.get("started"))return r={code:"NOT_RUNNING",msg:"Cannot run - recipe not started."},logger.warn(r),t(r);n.name=n.get("probeName")||n.get("id");if(!n.context){n.context=vm?vm.createContext({}):{},n.context.console=console,n.context.logger=Monitor.getLogger("Recipe.run."+n.name);for(var i in n.monitors)n.context[i]=n.monitors[i]}try{n.run(n.context)}catch(s){r="Error running script: "+s.toString(),logger.error("run_control",r)}t(r)},run:function(context){var t=this,script=t.get("script");vm?(t.compiledScript||(t.compiledScript=vm.createScript(script)),t.compiledScript.runInContext(context,t.name)):(eval(t.bringLocal(context)),eval(script))},bringLocal:function(e){var t,n=[];for(t in e)n.push("var "+t+" = context."+t+";");return n.join("\n")}})}(this),function(e){var t=e.Monitor||require("../Monitor"),n=t._,r=t.Cron,i=t.Probe,s=t.Backbone,o=1e3,u="* * * * * *",a=t.PollingProbe=i.extend({defaults:n.extend({},i.prototype.defaults,{pollInterval:null,cronPattern:u}),initialize:function(){var e=this,t=e.get("pollInterval"),n=e.get("cronPattern"),s=function(){e.poll()};i.prototype.initialize.apply(e,arguments),t==null&&n===u&&(t=o),e.poll();if(t!==0)if(t)e.timer=setInterval(s,t);else{if(!r)throw new Error("Cron is not available in this client");e.cronJob=new r.CronJob(n,s)}},release:function(){var e=this,t=e.cronJob?e.cronJob.timer:e.timer;e.cronJob&&!e.cronJob.initiated?setTimeout(function(){clearInterval(e.cronJob.timer)},1e3):e.timer&&clearInterval(t),e.timer=e.cron=null,i.prototype.release.apply(e,arguments)}})}(this),function(e){var t=e.Monitor||require("../Monitor"),n=t.Probe,r=t._,i=1e3,s=t.StreamProbe=n.extend({defaults:r.extend({},n.prototype.defaults,{bundle:[],interval:i,sequence:0}),initialize:function(){var e=this;n.prototype.initialize.apply(e,arguments),e.interval=e.get("interval"),e.queue=[],e.timer=null,e.lastSendTime=0},queueItem:function(e){var t=this,n=Date.now(),r=n-t.lastSendTime;t.queue.push(e),r>t.interval?t._send():t.timer||(t.timer=setTimeout(function(){t._send()},t.interval-r))},_send:function(){var e=this,t=Date.now();e.lastSendTime=t,e.set({bundle:e.queue,sequence:e.get("sequence")+1}),e.queue=[],e.timer&&(clearTimeout(e.timer),e.timer=null)}})}(this),function(root){var Monitor=root.Monitor||require("../Monitor"),_=Monitor._,logger=Monitor.getLogger("InspectProbe"),Backbone=Monitor.Backbone,PollingProbe=Monitor.PollingProbe,DEFAULT_DEPTH=2,InspectProbe=Monitor.InspectProbe=PollingProbe.extend({probeClass:"Inspect",writableAttributes:["value"],initialize:function(e){var t=this;t.key=e.key,typeof e.key=="undefined"&&(t.key=typeof window=="undefined"?"global":"window"),typeof e.depth=="undefined"?!e.key&&t.key==="window"?t.depth=1:t.depth=DEFAULT_DEPTH:t.depth=e.depth,t.value=t._evaluate(t.key),t.isModel=t.value instanceof Backbone.Model,t.set({value:Monitor.deepCopy(t.value,t.depth),isModel:t.isModel}),t.isModel?t.value.on("change",t.poll,t):PollingProbe.prototype.initialize.apply(t,arguments)},set_control:function(e,t){var n=this;if(typeof e.value=="undefined")return t({code:"NO_VALUE"});if(n.isModel)n.value.set(e.value);else{var r=JSON.stringify(e.value);n._evaluate(n.key+" = "+r),n.set("value",e.value)}return t()},release:function(){var e=this;e.isModel?e.value.off("change",e.poll,e):PollingProbe.prototype.release.apply(e,arguments)},eval_control:function(e,t){var n=this;t=typeof t=="undefined"?DEFAULT_DEPTH:t;var r=n._evaluate(e);return Monitor.deepCopy(r,t)},_evaluate:function(expression){var t=this,value=null;try{value=eval(expression)}catch(e){var err='Unable to evaluate expression: "'+expression+'"';throw logger.error("evaluate",err),new Error(err)}return value},poll:function(){var e=this,t=e.eval_control(e.key,e.depth);_.isEqual(t,e.get("value"))||e.set({value:t})}})}(this),function(e){var t=e.Monitor||require("../Monitor"),n=t._,r=t.StreamProbe,i=t.Stat,s="*",o=t.StatProbe=r.extend({probeClass:"Stat",defaults:n.extend({},r.prototype.defaults,{pattern:s}),initialize:function(){var e=this;r.prototype.initialize.apply(e,arguments),e.watcher=function(){var t=n.toArray(arguments);t.splice(0,0,JSON.stringify(new Date).substr(1,24)),e.queueItem.call(e,t)},i.on(e.get("pattern"),e.watcher)},release:function(){var e=this;i.off(e.get("pattern"),e.watcher)}})}(this),function(e){var t=e.Monitor||require("../Monitor"),n=t._,r=t.StreamProbe,i=t.Log,s="*",o=t.LogProbe=r.extend({probeClass:"Log",defaults:n.extend({},r.prototype.defaults,{pattern:s}),initialize:function(){var e=this;r.prototype.initialize.apply(e,arguments),e.watcher=function(){var t=n.toArray(arguments);t.splice(0,0,JSON.stringify(new Date).substr(1,24)),e.queueItem.call(e,t)},i.on(e.get("pattern"),e.watcher)},release:function(){var e=this;i.off(e.get("pattern"),e.watcher)}})}(this);